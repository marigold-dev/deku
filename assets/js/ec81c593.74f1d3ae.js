(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[855],{27642:(t,e,n)=>{"use strict";n.d(e,{Z:()=>L});var i=n(80472),r=n(66952),o=n(87483),s=n(80429),a=n(44119),l=n(30816).Buffer;function u(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{l(i.next(t))}catch(e){o(e)}}function a(t){try{l(i.throw(t))}catch(e){o(e)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}l((i=i.apply(t,e||[])).next())}))}class c{constructor(t){this._contract=t}level(){return u(this,void 0,void 0,(function*(){const t=yield this._contract();return(yield t.storage()).root_hash.current_block_level.c[0]}))}validators(){return u(this,void 0,void 0,(function*(){const t=yield this._contract();return(yield t.storage()).root_hash.current_validators}))}address(){return u(this,void 0,void 0,(function*(){return(yield this._contract()).address}))}}const d={Do:new Uint8Array([86,124]),Db:new Uint8Array([85,22])},p=t=>{const e=a.Base58.decode(t),n=new Uint8Array(e.buffer).slice(0,34);return"0x"+l.from(n.slice(2)).toString("hex")},h=t=>((t,e)=>{const n=o.blake2b(e,void 0,32),i=new Uint8Array(t.length+n.length);return i.set(t),i.set(n,t.length),s.encode(l.from(i))})(d.Do,t),g=(t,e)=>[t,e];class v{constructor(){this._json=null}static of(t){const e=new v;return e._json=t,e}null(){return v.of(null)}at(t){if(null===this._json)return this.null();if("object"!=typeof this._json)return this.null();if(Array.isArray(this._json))return this.null();if(!(t in this._json))return this.null();const e=this._json[t];return v.of(e)}as_string(){return null===this._json||"string"!=typeof this._json?null:this._json}as_int(){return null===this._json||"number"!=typeof this._json?null:this._json}as_array(){return null===this._json?null:Array.isArray(this._json)?this._json.map((t=>v.of(t))):null}as_string_array(){if(null===this._json)return null;if(!Array.isArray(this._json))return null;const t=this._json.flatMap((t=>{const e=v.of(t).as_string();return null===e?[]:[e]}));return t.length===this._json.length?t:null}as_json(){return this._json}as_bool(){return null===this._json||"boolean"!=typeof this._json?null:this._json}}var m={ofDTO:t=>{const e=t.at("key").as_string(),n=t.at("signature").as_string(),i=t.at("block"),r=i.at("author").as_string(),o=Number(i.at("level")),s=i.at("previous").as_string(),a=i.at("payload").as_string_array(),l=i.at("tezos_operations").as_string_array();return null===e||null===n||null===r||null===o||null===s||null===a||null===l?null:{key:e,signature:n,block:{author:r,level:o,previous:s,payload:a,tezos_operations:l}}}};var y={ofDTO:t=>{console.log(t.as_json());const e=t.at("withdrawal_handles_hash").as_string(),n=t.at("handle"),i=t.at("proof").as_array();if(null===i)return null;const r=i.flatMap((t=>{const e=t.as_array();if(null===e)throw"nope";return[e]})).flat();console.log(r);const o=r.flatMap((t=>{const e=t.as_string();if(null===e)throw console.log(e),"Nope";return[p(e)]})),s=n.at("id").as_int(),a=n.at("owner").as_array(),l=n.at("ticket_id").as_array();if(null===l)return null;const u=l[1].at("ticketer").as_string(),c=l[1].at("data").as_string(),d=n.at("hash").as_string(),h=n.at("amount").as_string();if(null===e)return null;if(console.log("a"),null===i)return null;if(console.log("b"),null===s)return null;if(console.log("c"),null===a)return null;if(console.log("d"),null===u)return null;if(console.log("e"),null===c)return null;if(console.log("f"),null===d)return null;if(console.log("g"),null===h)return null;console.log("h");const g=a[1].as_string();return null===g?null:(console.log("i"),{withdrawal_handles_hash:p(e),handle:{id:s,owner:g,ticket_id:{ticketer:u,data:c},hash:d,amount:h},proof:o})}};function f(t){const e=[];if(0===t.length)return"";if("string"!=typeof t[0])throw new TypeError("Url must be a string. Received "+t[0]);t[0].match(/^[^/:]+:\/*$/)&&t.length>1&&(t[0]=t.shift()+t[0]),t[0].match(/^file:\/\/\//)?t[0]=t[0].replace(/^([^/:]+):\/*/,"$1:///"):t[0]=t[0].replace(/^([^/:]+):\/*/,"$1://");for(let r=0;r<t.length;r++){let n=t[r];if("string"!=typeof n)throw new TypeError("Url must be a string. Received "+n);""!==n&&(r>0&&(n=n.replace(/^[/]+/,"")),n=r<t.length-1?n.replace(/[/]+$/,""):n.replace(/[/]+$/,"/"),e.push(n))}let n=e.join("/");n=n.replace(/\/(\?|&|#[^!])/g,"$1");const i=n.split("?");return n=i.shift()+(i.length>0?"?":"")+i.join("&"),n}function k(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=Array.from(Array.isArray(e[0])?e[0]:e);return f(i)}const _=(t,e,n)=>u(void 0,void 0,void 0,(function*(){if(e!==t.expectedStatus)return Promise.reject(n);const i=v.of(n),r=t.parse(i);return null===r?Promise.reject({type:"ERROR",msg:"please contact the team"}):r})),w=t=>u(void 0,void 0,void 0,(function*(){const e=t.uri,n=yield fetch(e),i=n.status,r=yield n.json();return _(t,i,r)})),b=(t,e)=>u(void 0,void 0,void 0,(function*(){const n=t.uri,i=JSON.stringify(e),r=yield fetch(n,{method:"POST",body:i}),o=r.status,s=yield r.json();return _(t,o,s)}));class O{signOperation(t){return u(this,void 0,void 0,(function*(){const e=t.bytes,n=yield this.sign(e.toString("hex")),i=yield this.publicKey(),r=function(t){const{nonce:e,level:n,operation:i}=t;return{nonce:e,level:n,operation:i}}(t);return{key:i,signature:n,initial:r}}))}}class S{constructor(t){var e;this.encodeOperation=(t,e,n)=>u(this,void 0,void 0,(function*(){const i={nonce:t,level:e,operation:n};return b(this.endpoints.ENCODE_OPERATION,i)})),this.dekuRpc=t.dekuRpc,this.endpoints={GET_CHAIN_INFO:{uri:k(e=t.dekuRpc,"/api/v1/chain/info"),expectedStatus:200,parse:t=>{const e=t.at("consensus").as_string();if(null===e)return null;const n=t.at("in_sync").as_bool();return null===n?null:{consensus:e,inSync:n}}},GET_CURRENT_LEVEL:{uri:k(e,"/api/v1/chain/level"),expectedStatus:200,parse:t=>t.at("level").as_int()},GET_BLOCK_BY_LEVEL:t=>({uri:k(e,`/api/v1/chain/blocks/${t}`),expectedStatus:200,parse:m.ofDTO}),GET_BLOCK_BY_HASH:t=>({uri:k(e,`/api/v1/chain/blocks/${t}`),expectedStatus:200,parse:m.ofDTO}),GET_GENESIS:{uri:k(e,"/api/v1/chain/blocks/genesis"),expectedStatus:200,parse:m.ofDTO},GET_CURRENT_BLOCK:{uri:k(e,"/api/v1/chain/blocks/genesis"),expectedStatus:200,parse:m.ofDTO},GET_BALANCE:(t,n)=>({uri:k(e,`/api/v1/balance/${t}/${n[0]}/${n[1]}`),expectedStatus:200,parse:t=>t.at("balance").as_int()}),GET_PROOF:t=>({uri:k(e,`/api/v1/proof/${t}`),expectedStatus:200,parse:y.ofDTO}),OPERATIONS:{uri:k(e,"/api/v1/operations"),expectedStatus:200,parse:t=>t.at("hash").as_string()},GET_VM_STATE:{uri:k(e,"/api/v1/state/unix"),expectedStatus:200,parse:t=>t.as_json()},ENCODE_OPERATION:{uri:k(e,"/api/v1/helpers/encode-operation"),expectedStatus:200,parse:t=>{const e=t.at("bytes").as_string();return null===e?null:l.from(e,"hex")}}},this._dekuSigner=t.dekuSigner}setDekuSigner(t){return this._dekuSigner=t,this}assertTzWallet(){if(!this._dekuSigner)throw new Error("Tezos wallet required, see setTzWallet");return this._dekuSigner}setTezosRpc(t){const e=new r.$N(t),n=this.endpoints.GET_CHAIN_INFO;return this._consensus=new c((()=>w(n).then((t=>{let{consensus:n}=t;return e.contract.at(n)})))),this}get consensus(){return this._consensus}get discovery(){throw"Not implemented"}info(){return u(this,void 0,void 0,(function*(){return yield w(this.endpoints.GET_CHAIN_INFO)}))}level(){return u(this,void 0,void 0,(function*(){return yield w(this.endpoints.GET_CURRENT_LEVEL)}))}getBlockByLevel(t){return u(this,void 0,void 0,(function*(){return yield w(this.endpoints.GET_BLOCK_BY_LEVEL(t))}))}getBlockByHash(t){return u(this,void 0,void 0,(function*(){return yield w(this.endpoints.GET_BLOCK_BY_HASH(t))}))}getGenesis(){return u(this,void 0,void 0,(function*(){return yield w(this.endpoints.GET_GENESIS)}))}getCurrentBlock(){return u(this,void 0,void 0,(function*(){return yield w(this.endpoints.GET_CURRENT_BLOCK)}))}getBalance(t,e){let{ticketer:n,data:i}=e;return u(this,void 0,void 0,(function*(){const e=g(n,i.startsWith("0x")?i:"0x"+i);return yield w(this.endpoints.GET_BALANCE(t,e))}))}getProof(t){return u(this,void 0,void 0,(function*(){return yield w(this.endpoints.GET_PROOF(t))}))}submitOperation(t){return u(this,void 0,void 0,(function*(){const e=this.assertTzWallet(),n=yield e.signOperation(t);return yield b(this.endpoints.OPERATIONS,n)}))}getVmState(){return u(this,void 0,void 0,(function*(){return yield w(this.endpoints.GET_VM_STATE)}))}parseOperationOptions(t){return u(this,void 0,void 0,(function*(){const e=this.assertTzWallet();return{source:yield e.publicKeyHash(),level:void 0===t||void 0===t.level?yield this.level():t.level,nonce:void 0===t||void 0===t.nonce?Math.floor(2147483647*Math.random()).toString():(t=>t.toString())(t.nonce)}}))}transferTo(t,e,n,i,r){return u(this,void 0,void 0,(function*(){const{source:o,level:s,nonce:a}=yield this.parseOperationOptions(r),l=yield((t,e,n,i,r,o,s,a)=>u(void 0,void 0,void 0,(function*(){const l={type:"ticket_transfer",sender:i,receiver:r,amount:o.toString(),ticket_id:[s,a]},u=yield t(n,e,l);return{bytes:u,hash:h(u),nonce:n,level:e,operation:l}})))(this.encodeOperation,s,a,o,t,e,n,i);return this.submitOperation(l)}))}submitVmOperation(t,e,n){return u(this,void 0,void 0,(function*(){const{source:i,level:r,nonce:o}=yield this.parseOperationOptions(n),s=yield((t,e,n,i,r,o)=>u(void 0,void 0,void 0,(function*(){const s=o.map((t=>{let{ticket_id:e,amount:n}=t;return[e,n.toString()]})),a={type:"vm_transaction",sender:i,operation:{operation:r,tickets:s}},l=yield t(n,e,a);return{bytes:l,hash:h(l),nonce:n,level:e,operation:a}})))(this.encodeOperation,r,o,i,t,e);return this.submitOperation(s)}))}withdrawTo(t,e,n,i,r){return u(this,void 0,void 0,(function*(){const{source:o,level:s,nonce:a}=yield this.parseOperationOptions(r),l=yield((t,e,n,i,r,o,s)=>u(void 0,void 0,void 0,(function*(){const a={type:"withdraw",sender:i,ticket_id:r,amount:o.toString(),owner:s},l=yield t(n,e,a);return{bytes:l,hash:h(l),nonce:n,level:e,operation:a}})))(this.encodeOperation,s,a,o,g(n,i),e,t);return this.submitOperation(l)}))}submitNoopOperation(t){return u(this,void 0,void 0,(function*(){const{source:e,level:n,nonce:i}=yield this.parseOperationOptions(t),r=yield((t,e,n,i)=>u(void 0,void 0,void 0,(function*(){const r={type:"noop",sender:i},o=yield t(n,e,r);return{bytes:o,hash:h(o),nonce:n,level:e,operation:r}})))(this.encodeOperation,n,i,e);return this.submitOperation(r)}))}wait(t){return u(this,void 0,void 0,(function*(){throw console.log(t),"Feature not yet implemented"}))}}function C(){function t(t){const e=[];if(0===t.length)return"";if("string"!=typeof t[0])throw new TypeError("Url must be a string. Received "+t[0]);t[0].match(/^[^/:]+:\/*$/)&&t.length>1&&(t[0]=t.shift()+t[0]),t[0].match(/^file:\/\/\//)?t[0]=t[0].replace(/^([^/:]+):\/*/,"$1:///"):t[0]=t[0].replace(/^([^/:]+):\/*/,"$1://");for(let r=0;r<t.length;r++){let n=t[r];if("string"!=typeof n)throw new TypeError("Url must be a string. Received "+n);""!==n&&(r>0&&(n=n.replace(/^[\/]+/,"")),n=r<t.length-1?n.replace(/[\/]+$/,""):n.replace(/[\/]+$/,"/"),e.push(n))}let n=e.join("/");n=n.replace(/\/(\?|&|#[^!])/g,"$1");const i=n.split("?");return n=i.shift()+(i.length>0?"?":"")+i.join("&"),n}for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];const r=Array.from(Array.isArray(n[0])?n[0]:n);return t(r)}const N=(t,e)=>u(void 0,void 0,void 0,(function*(){const n={hash:e},i=yield fetch(C(t,"/api/v1/helpers/compute-contract-hash"),{method:"POST",body:JSON.stringify(n)}),r=yield i.json();if(i.ok)return r.address;throw r}));const E=(t,e)=>{let{kind:n,source:i,initialStorage:r,target:o="wasm"}=e;return u(void 0,void 0,void 0,(function*(){const e={lang:n,source:i,storage:r},s={method:"POST",type:"appliction/json",body:JSON.stringify(e)},a=C(t,"/api/v1/compile-contract"+("michelson"===o?"?target=michelson":"")),l=yield fetch(a,s);if(l.status>200)throw new Error(l.statusText);return l.json()}))},T=(t,e)=>u(void 0,void 0,void 0,(function*(){const n={method:"POST",body:JSON.stringify({source:"source"in e?e.source:"",lang:e.kind,expression:e.expression,address:e.address})},i="michelson"===e.target?"?target=michelson":"",r=yield fetch(t+"/api/v1/compile-invocation"+i,n);if(r.status>200){const t=yield r.text();throw new Error(t)}return r.json()})),R=t=>{if(null===t)return null;if(!Array.isArray(t))return null;const e=t[0];switch(e){case"Int":const n=t[1];return Number.parseInt(n);case"String":return t[1];case"Map":{const e=t[1];return null===e?null:Array.isArray(e)?e.reduce(((t,e)=>{if(!Array.isArray(e))return t;const n=R(e[0]),i=R(e[1]);return Object.assign({[n]:i},t)}),{}):null}case"Pair":{const e=t[1],n=e[0],i=e[1];return[R(n),R(i)]}case"List":return t[1].map((t=>R(t)));case"Set":return t[1].map((t=>R(t)));case"Union":{const e=t[1],n=e[0],i=e[1];switch(n){case"Right":return{right:R(i)};case"Left":return{left:R(i)};default:return null}}case"Option":{const e=t[1],n=e[0],i=e[1];switch(n){case"None":return{none:!0};case"Some":return{none:!1,some:R(i)};default:return null}}case"Unit":return null;default:return console.error(`type ${e} is not yet implemented`),null}},D="You must initialize the DekuCClient with a ligo rpc URL to use this method.";class j{constructor(t){this.deku=t.deku,this.address=t.contractAddress,this.fetchInterval=null,this.code="source"in t?{source:t.source,kind:t.kind}:void 0}invokeRaw(t){return u(this,void 0,void 0,(function*(){const e={address:this.address,argument:t};return yield this.deku.submitVmOperation(e,[])}))}invokeMichelson(t){return u(this,void 0,void 0,(function*(){if(this.deku.ligoRpc){const{operation:e,tickets:n}=yield T(this.deku.ligoRpc,{kind:"michelson",expression:t,address:this.address});return yield this.deku.submitVmOperation(e,n)}throw new Error(D)}))}invokeLigo(t){return u(this,void 0,void 0,(function*(){switch(!0){case!this.deku.ligoRpc:throw new Error(D);case!this.code:throw new Error("You must initialize the Contract class with Ligo source code to use the Ligo functionality");case"michelson"==this.code.kind:throw new Error("Can't use Ligo functionality when the provided source code is Michelson. Did you mean to use `invoke` instead of `invokeLigo`?");default:const{operation:e,tickets:n}=yield T(this.deku.ligoRpc,{source:this.code.source,kind:this.code.kind,expression:t,address:this.address});return yield this.deku.submitVmOperation(e,n)}}))}getRawInfos(){return u(this,void 0,void 0,(function*(){const t=yield this.deku.getVmState();if(null===t)return null;const e=t[this.address];return null===e?null:e}))}getRawState(){return u(this,void 0,void 0,(function*(){const t=yield this.getRawInfos();return null===t?null:t.state}))}getState(){return u(this,void 0,void 0,(function*(){const t=yield this.getRawState();return null===t?null:R(t)}))}getEntrypoints(){return u(this,void 0,void 0,(function*(){const t=yield this.getRawInfos();return null===t?null:t.entrypoints}))}onNewState(t){return u(this,void 0,void 0,(function*(){let e=null;this.fetchInterval&&clearInterval(this.fetchInterval),this.fetchInterval=setInterval((()=>{this.getState().then((n=>{const i=JSON.stringify(e);return JSON.stringify(n)===i||(t(n),e=n),null})).catch(console.error)}),2e3)}))}}const I=(t=>new class extends O{constructor(){super(...arguments),this.sign=e=>u(this,void 0,void 0,(function*(){return(yield t.sign(e)).prefixSig})),this.publicKey=()=>t.publicKey(),this.publicKeyHash=()=>t.publicKeyHash()}})(new i.iv("edsk3ym86W81aL2gfZ25WuWQrisJM5Vu8cEayCR6BGsRNgfRWos8mR")),L={incrementLigoCode:'\ntype storage = int;\n\ntype parameter =\n  | ["Increment", int]\n  | ["Decrement", int]\n  | ["Reset"];\n\ntype return_ = [list<operation>,storage];\n\nconst main = (action: parameter, store: storage): return_ => {\n  let storage = match(action, {\n    Increment: n => store + n,\n    Decrement: n => store - n,\n    Reset: () => 0\n  });\n  return [list([]), storage]\n};\n',dekuC:new class extends S{constructor(t){var e,n;super(Object.assign(Object.assign({},t),{dekuRpc:null!==(e=t.dekuRpc)&&void 0!==e?e:"https://deku-canonical-vm0.deku-v1.marigold.dev/"})),this.ligoRpc=null!==(n=t.ligoRpc)&&void 0!==n?n:"https://ligo-deku-rpc.marigold.dev"}assertHasSigner(){if(null==this._dekuSigner)throw new Error("Tezos wallet required");return this._dekuSigner}originateLigo(t){let{kind:e,source:n,initialStorage:i}=t;return u(this,void 0,void 0,(function*(){this.assertHasSigner();const{operation:t,tickets:r}=yield E(this.ligoRpc,{kind:e,source:n,initialStorage:i,target:"wasm"}),o=yield this.submitVmOperation(t,r);return{operation:o,address:yield N(this.dekuRpc,o)}}))}originateTz(t){let{source:e,initialStorage:n}=t;return u(this,void 0,void 0,(function*(){this.assertHasSigner();const{operation:t,tickets:i}=yield E(this.ligoRpc,{kind:"michelson",source:e,initialStorage:n,target:"wasm"}),r=yield this.submitVmOperation(t,i);return{operation:r,address:yield N(this.dekuRpc,r)}}))}contract(t,e){return new j(Object.assign({deku:this,contractAddress:t},e))}}({dekuRpc:"https://deku-canonical-vm0.deku-v1.marigold.dev",ligoRpc:"https://ligo-deku-rpc.marigold.dev",dekuSigner:I})}},62219:(t,e,n)=>{"use strict";n.r(e),n.d(e,{assets:()=>l,contentTitle:()=>s,default:()=>d,frontMatter:()=>o,metadata:()=>a,toc:()=>u});var i=n(25773),r=(n(27378),n(35318));n(50353),n(60042),n(78936),n(27642);const o={sidebar_position:2},s="Quick-start with Deku-C",a={unversionedId:"Deku-Canonical/dekuc_quickstart",id:"Deku-Canonical/dekuc_quickstart",title:"Quick-start with Deku-C",description:"In this 15-minute tutorial, we'll create our first DApp to Deku-C.",source:"@site/../docs/Deku-Canonical/dekuc_quickstart.md",sourceDirName:"Deku-Canonical",slug:"/Deku-Canonical/dekuc_quickstart",permalink:"/docs/Deku-Canonical/dekuc_quickstart",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/../docs/Deku-Canonical/dekuc_quickstart.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"Deku Canonical",permalink:"/docs/category/deku-canonical"},next:{title:"Deku CLI",permalink:"/docs/Deku-Canonical/deku_c_cli"}},l={},u=[{value:"Installing the Tools",id:"installing-the-tools",level:2},{value:"Our First Smart Contract",id:"our-first-smart-contract",level:2},{value:"Deploying Our Contract",id:"deploying-our-contract",level:2},{value:"Interacting with our Contract",id:"interacting-with-our-contract",level:2}],c={toc:u};function d(t){let{components:e,...n}=t;return(0,r.kt)("wrapper",(0,i.Z)({},c,n,{components:e,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"quick-start-with-deku-c"},"Quick-start with Deku-C"),(0,r.kt)("p",null,"In this 15-minute tutorial, we'll create our first DApp to Deku-C."),(0,r.kt)("p",null,"You'll learn how to:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Write a simple smart contract in ",(0,r.kt)("a",{parentName:"li",href:"https://ligolang.org/"},"Ligo"),"."),(0,r.kt)("li",{parentName:"ul"},"Compile and deploy it to Deku-C"),(0,r.kt)("li",{parentName:"ul"},"Interact with the contract via\n",(0,r.kt)("a",{parentName:"li",href:"https://www.npmjs.com/package/@marigold-dev/deku"},(0,r.kt)("inlineCode",{parentName:"a"},"@marigold-dev/deku")))),(0,r.kt)("h2",{id:"installing-the-tools"},"Installing the Tools"),(0,r.kt)("p",null,"You can run deploy the contract in-browser without installing any additional\ntools."),(0,r.kt)("p",null,"However, to follow along on along on the command line and to start developing\nyour own contracts, you'll need to install the LIGO compiler - check the\n",(0,r.kt)("a",{parentName:"p",href:"https://ligolang.org/docs/intro/installation"},"installation instructions")," for\nyour platform. This tutorial requires version 0.53.0 or higher."),(0,r.kt)("p",null,"You'll also need to install the Deku CLI:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"npm install -g @marigold-dev/deku-cli\n")),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"See the ",(0,r.kt)("a",{parentName:"p",href:"/docs/Deku-Canonical/deku_c_cli"},"Deku CLI Tutorial")," for more on using the CLI!")),(0,r.kt)("h2",{id:"our-first-smart-contract"},"Our First Smart Contract"),(0,r.kt)("p",null,"Let's write a simple counter, accepting the commands ",(0,r.kt)("inlineCode",{parentName:"p"},"Increment"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"Decrement"),",\n",(0,r.kt)("inlineCode",{parentName:"p"},"Reset"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'type storage = int;\n\ntype parameter = ["Increment", int] | ["Decrement", int] | ["Reset"];\n\ntype return_ = [list<operation>, storage];\n\nconst main = (action: parameter, store: storage): return_ => {\n  let storage = match(action, {\n    Increment: (n) => store + n,\n    Decrement: (n) => store - n,\n    Reset: () => 0,\n  });\n  return [list([]), storage];\n};\n')),(0,r.kt)("p",null,"Refer to the ",(0,r.kt)("a",{parentName:"p",href:"https://ligolang.org/docs/intro/introduction"},"Ligo documentation"),"\nfor more on developing with Ligo, and don't hesitate to\n",(0,r.kt)("a",{parentName:"p",href:"https://ligolang.org/contact"},"reach out"),"!"),(0,r.kt)("h2",{id:"deploying-our-contract"},"Deploying Our Contract"),(0,r.kt)("p",null,"We can originate our contract using ",(0,r.kt)("inlineCode",{parentName:"p"},"@marigold-dev/deku"),", a Deku-C client\nwritten in Typescript package. The client depends on\n",(0,r.kt)("a",{parentName:"p",href:"https://tezostaquito.io/"},"Taquito")," for signing interactions with Deku chain.\nTaquito provides options for using a variety of browser-based and hardware\nwallets, but for convenience we'll use the in-memory signer."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'import { DekuCClient } from "@marigold-dev/deku"\nimport { fromMemorySigner } from "@marigold-dev/deku"\nimport { InMemorySigner } from "@taquito/signer"\n\nconst memory = new InMemorySigner(\n  "edsk3ym86W81aL2gfZ25WuWQrisJM5Vu8cEayCR6BGsRNgfRWos8mR"\n);\nconst dekuSigner = fromMemorySigner(memory);\n\nconst dekuC = new DekuCClient({\n  dekuRpc: "https://deku-canonical-vm0.deku-v1.marigold.dev/",\n  ligoRpc: "https://ligo-deku-rpc.marigold.dev"\n  dekuSigner,\n});\n')),(0,r.kt)("p",null,"With a connection to Deku-C established, we're ready to deploy our contract! Try\nrunning the example."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:"live noInline",live:!0,noInline:!0},'const params = {\n  kind: "jsligo",\n  // The deku client will compile your jsligo code for you\n  source: incrementLigoCode,\n  // Give the initial storage as a Ligo expression string\n  initialStorage: "1",\n};\n\nprintln(\n  `Deploying contract with initial storage ${JSON.stringify(\n    params.initialStorage\n  )}...`\n);\ndekuC.originateLigo(params).then(({ operation, address }) => {\n  println(`Operation successful! Operation hash: ${operation}`);\n  println(`Deployment successful! New contract address: ${address}`);\n});\n')),(0,r.kt)("br",null),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"In addition to using ",(0,r.kt)("inlineCode",{parentName:"p"},"deku-toolkit")," and/or command-line tools, you can\nalso develop Deku-C contract directly from your browser with the\n",(0,r.kt)("a",{parentName:"p",href:"https://ide.ligolang.org/"},"LIGO Playground"),"!")),(0,r.kt)("h2",{id:"interacting-with-our-contract"},"Interacting with our Contract"),(0,r.kt)("p",null,"Once deployed, we can use the Deku-C client to query and subscribe to our\ncontract's state, as well as invoke operations. In the live editor below, we've\nhard-coded the address of a contract on Deku-C, but you can replace it with the\nDK1 address of the contract you deployed above."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:"live noInline",live:!0,noInline:!0},'const code = { source: incrementLigoCode, kind: "jsligo" };\nconst myContract = dekuC.contract("DK14bVHNFE7QMQtQ8qdscz7w88RDsWoj7gqJ", code); // \ud83d\udc48 Replace with your contract address\n\nprintln("Getting contract state...");\nmyContract\n  .getState()\n  .then((state) => println(`Current state is ${JSON.stringify(state)}`))\n  .then(() => {\n    // subscribe to changes\n    myContract.onNewState((newState) =>\n      println(\n        `Contract state updated, next state is: ${JSON.stringify(newState)}`\n      )\n    );\n\n    myContract.invokeLigo("Increment(3)");\n  });\n')))}d.isMDXComponent=!0},78936:(t,e,n)=>{"use strict";n.d(e,{Z:()=>i});const i={playgroundEditorWrapper:"playgroundEditorWrapper_NVrK",liveEditorBg:"liveEditorBg_jBTB",playgroundHeader:"playgroundHeader_qwyd",playgroundEditorHeader:"playgroundEditorHeader_nLzM",playgroundPreviewHeader:"playgroundPreviewHeader_vpQ2",playgroundPreview:"playgroundPreview_bb8I",button:"button_G4Yn",copyButton:"copyButton_q7gX",runButton:"runButton_oaHB"}},91586:()=>{},45545:()=>{},46047:()=>{},50471:()=>{},71632:()=>{}}]);