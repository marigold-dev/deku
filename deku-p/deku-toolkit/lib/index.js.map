{"version":3,"file":"index.js","sources":["../src/contracts/consensus.ts","../src/core/level.ts","../src/core/nonce.ts","../src/core/amount.ts","../src/utils/hash.ts","../src/core/operation.ts","../src/core/ticket-id.ts","../src/utils/json.ts","../src/core/block.ts","../src/core/proof.ts","../src/utils/urlJoin.ts","../src/network/index.ts","../src/utils/signers.ts","../src/index.ts"],"sourcesContent":["import { ContractAbstraction, ContractProvider } from \"@taquito/taquito\";\nimport { Level as LevelType } from \"../core/level\";\n\ntype consensus_storage = {\n  root_hash: {\n    current_block_level: {\n      c: Array<number>;\n    };\n    current_validators: Array<string>;\n  };\n  vault: {\n    vault: {\n      id: {\n        c: Array<number>;\n      };\n    };\n  };\n};\n\nexport default class Consensus {\n  private _contract: () => Promise<ContractAbstraction<ContractProvider>>;\n\n  constructor(contract: () => Promise<ContractAbstraction<ContractProvider>>) {\n    this._contract = contract;\n  }\n\n  /**\n   * Retrieve the level of the chain from the consensus contract\n   * @returns the level of the chain\n   */\n  async level(): Promise<LevelType> {\n    const contract = await this._contract();\n    const storage = await contract.storage<consensus_storage>();\n    return storage.root_hash.current_block_level.c[0];\n  }\n\n  /**\n   * Returns the list of tezos address of all validators known by the consensus\n   * @returns a list of tezos address\n   */\n  async validators(): Promise<Array<string>> {\n    const contract = await this._contract();\n    const storage = await contract.storage<consensus_storage>();\n    return storage.root_hash.current_validators;\n  }\n\n  /**\n   * Returns the address of the consensus contract\n   * @returns tezos address as string\n   */\n  async address(): Promise<string> {\n    return (await this._contract()).address;\n  }\n}\n","import JSONValue from \"../utils/json\";\n\nexport type Level = number;\n\nconst toDTO = (level: Level): string => {\n  return level.toString();\n};\n\nconst ofDTO = (json: JSONValue): Level | null => {\n  const string = json.as_string();\n  if (string === null) return null;\n  try {\n    return Number.parseInt(string);\n  } catch {\n    return null;\n  }\n};\n\nexport default {\n  toDTO,\n  ofDTO,\n};\n","import JSONValue from \"../utils/json\";\n\nexport type Nonce = number;\n\n/**\n * Creates a new once\n * @returns random number between 0 and 2**32\n */\nconst rand = (): Nonce => {\n  const maxInt32 = 2147483647;\n  const nonce = Math.floor(Math.random() * maxInt32);\n  return nonce;\n};\n\nconst toDTO = (nonce: Nonce): string => {\n  return nonce.toString();\n};\n\nconst ofDTO = (json: JSONValue): Nonce | null => {\n  const string = json.as_string();\n  if (string === null) return null;\n  try {\n    return Number.parseInt(string);\n  } catch {\n    return null;\n  }\n};\n\nexport default {\n  rand,\n  toDTO,\n  ofDTO,\n};\n","import JSONValue from \"../utils/json\";\n\nexport type Amount = number;\n\nconst toDTO = (amount: Amount): string => {\n  return amount.toString();\n};\n\nconst ofDTO = (json: JSONValue): Amount | null => {\n  const string = json.as_string();\n  if (string === null) return null;\n  try {\n    return Number.parseInt(string);\n  } catch {\n    return null;\n  }\n};\n\nexport default {\n  toDTO,\n  ofDTO,\n};\n","import { OperationHash as OperationHashType } from \"../core/operation-hash\";\nimport * as blake from \"blakejs\";\nimport * as bs58check from \"bs58check\";\nimport { Base58 } from \"@tzstamp/helpers\";\n\nconst PREFIX = {\n  Do: new Uint8Array([86, 124]),\n  Db: new Uint8Array([85, 22]),\n};\n\n/**\n * Hash the string representation of the payload, returns the b58 reprensentation starting with the given prefix\n * @param prefix the prefix of your hash\n * @returns\n */\nconst toB58Hash = (prefix: Uint8Array, bytes: Buffer) => {\n  const blakeHash = blake.blake2b(bytes, undefined, 32);\n  const tmp = new Uint8Array(prefix.length + blakeHash.length);\n  tmp.set(prefix);\n  tmp.set(blakeHash, prefix.length);\n  const b58 = bs58check.encode(Buffer.from(tmp));\n  return b58;\n};\n\n// TODO: Where is it used ?\nexport const fromB58Hash = (x: string): string => {\n  const y = Base58.decode(x);\n  const tmp = new Uint8Array(y.buffer).slice(0, 32 + 2);\n  return \"0x\" + Buffer.from(tmp.slice(2)).toString(\"hex\");\n};\n\n// TODO: Find a way to replace the buffer\nexport const hashOperation = (bytes: Buffer): OperationHashType => {\n  return toB58Hash(PREFIX.Do, bytes);\n};\n","import Amount, { Amount as AmountType } from \"./amount\";\nimport { KeyHash as KeyHashType } from \"./key-hash\";\nimport Level, { Level as LevelType } from \"./level\";\nimport Nonce, { Nonce as NonceType } from \"./nonce\";\nimport { JSONType } from \"../utils/json\";\nimport { OperationHash as OperationHashType } from \"./operation-hash\";\nimport { hashOperation } from \"../utils/hash\";\n\ntype OperationTicketTransfer = {\n  sender: KeyHashType;\n  receiver: KeyHashType;\n  ticketId: { ticketer: string; data: string };\n  amount: AmountType;\n};\n\nconst ticketTransferToDTO = (transfer: OperationTicketTransfer) => {\n  const {\n    sender,\n    receiver,\n    ticketId: { ticketer, data },\n    amount,\n  } = transfer;\n  return [\n    \"Operation_ticket_transfer\",\n    {\n      sender,\n      receiver,\n      ticket_id: [\"Ticket_id\", { ticketer, data }],\n      amount: Amount.toDTO(amount),\n    },\n  ];\n};\n\ntype OperationVmTransaction = {\n  sender: KeyHashType;\n  operation: unknown;\n};\n\nconst vmTransactionToDTO = (vmTransaction: OperationVmTransaction) => {\n  const { sender, operation } = vmTransaction;\n  return [\n    \"Operation_vm_transaction\",\n    {\n      sender,\n      /* eslint-disable  @typescript-eslint/no-explicit-any */\n      operation: operation as any, // The toolkit does not know what is inside the payload, because deku is parametric, so it makes sense to type this as any\n    },\n  ];\n};\n\ntype OperationWithdraw = {\n  sender: KeyHashType;\n  owner: KeyHashType; // \"tezos type\",\n  amount: AmountType;\n  ticketId: { ticketer: string; data: string };\n};\n\nconst withdrawToDTO = (withdraw: OperationWithdraw) => {\n  const {\n    sender,\n    owner,\n    ticketId: { ticketer, data },\n    amount,\n  } = withdraw;\n  return [\n    \"Operation_withdraw\",\n    {\n      sender,\n      owner: [\"Implicit\", owner],\n      ticket_id: [\"Ticket_id\", { ticketer, data }],\n      amount: Amount.toDTO(amount),\n    },\n  ];\n};\n\ntype OperationNoop = {\n  sender: KeyHashType;\n};\n\nconst noopToDTO = (noop: OperationNoop) => {\n  const { sender } = noop;\n  return [\n    \"Operation_noop\",\n    {\n      sender,\n    },\n  ];\n};\n\ntype OperationContent =\n  | OperationTicketTransfer\n  | OperationVmTransaction\n  | OperationWithdraw\n  | OperationNoop;\ntype OperationType = \"TicketTransfer\" | \"VmTransaction\" | \"Withdraw\" | \"Noop\";\n\n// named initial in deku\nexport type Operation = {\n  bytes: Buffer; // Should not be there\n  hash: OperationHashType;\n  nonce: NonceType;\n  level: LevelType;\n  type: OperationType;\n  operation: OperationContent;\n};\n\ntype encodeOperation = (\n  nonce: NonceType,\n  level: LevelType,\n  operation: JSONType\n) => Promise<Buffer>;\n\nconst createTransaction = async (\n  encodeOperation: encodeOperation,\n  level: LevelType,\n  nonce: NonceType,\n  sender: KeyHashType,\n  receiver: KeyHashType,\n  amount: AmountType,\n  ticketer: string,\n  data: string\n): Promise<Operation> => {\n  const operation = {\n    sender,\n    receiver,\n    ticketId: { ticketer, data },\n    amount,\n  };\n  const bytes = await encodeOperation(\n    nonce,\n    level,\n    ticketTransferToDTO(operation)\n  );\n  const hash = hashOperation(bytes);\n  return {\n    bytes,\n    hash,\n    nonce,\n    level,\n    type: \"TicketTransfer\",\n    operation,\n  };\n};\n\nconst createVmOperation = async (\n  encodeOperation: encodeOperation,\n  level: LevelType,\n  nonce: NonceType,\n  sender: KeyHashType,\n  payload: unknown\n): Promise<Operation> => {\n  const operation = {\n    sender,\n    operation: payload,\n  };\n  const bytes = await encodeOperation(\n    nonce,\n    level,\n    vmTransactionToDTO(operation)\n  );\n  const hash = hashOperation(bytes);\n  return {\n    bytes,\n    hash,\n    nonce,\n    level,\n    type: \"VmTransaction\",\n    operation,\n  };\n};\n\nconst createWithdraw = async (\n  encodeOperation: encodeOperation,\n  level: LevelType,\n  nonce: NonceType,\n  sender: KeyHashType,\n  owner: KeyHashType,\n  amount: AmountType,\n  ticketer: string,\n  data: string\n): Promise<Operation> => {\n  const operation = {\n    sender,\n    owner,\n    ticketId: { ticketer, data },\n    amount,\n  };\n  const bytes = await encodeOperation(nonce, level, withdrawToDTO(operation));\n  const hash = hashOperation(bytes);\n  return {\n    bytes,\n    hash,\n    nonce,\n    level,\n    type: \"Withdraw\",\n    operation,\n  };\n};\n\nconst createNoop = async (\n  encodeOperation: encodeOperation,\n  level: LevelType,\n  nonce: NonceType,\n  sender: KeyHashType\n): Promise<Operation> => {\n  const operation = { sender };\n  const bytes = await encodeOperation(nonce, level, noopToDTO(operation));\n  const hash = hashOperation(bytes);\n  return {\n    bytes,\n    hash,\n    nonce,\n    level,\n    type: \"Noop\",\n    operation,\n  };\n};\n\ntype DTO = [\n  \"Initial_operation\",\n  {\n    hash: string;\n    nonce: string;\n    level: string;\n    operation: JSONType;\n  }\n];\n\nconst toDTO = (operation: Operation): DTO => {\n  const { hash, nonce, level, type, operation: content } = operation;\n  switch (type) {\n    case \"TicketTransfer\":\n      return [\n        \"Initial_operation\",\n        {\n          hash: hash,\n          nonce: Nonce.toDTO(nonce),\n          level: Level.toDTO(level),\n          operation: ticketTransferToDTO(content as OperationTicketTransfer),\n        },\n      ];\n    case \"VmTransaction\":\n      return [\n        \"Initial_operation\",\n        {\n          hash: hash,\n          nonce: Nonce.toDTO(nonce),\n          level: Level.toDTO(level),\n          operation: vmTransactionToDTO(content as OperationVmTransaction),\n        },\n      ];\n    case \"Withdraw\":\n      return [\n        \"Initial_operation\",\n        {\n          hash: hash,\n          nonce: Nonce.toDTO(nonce),\n          level: Level.toDTO(level),\n          operation: withdrawToDTO(content as OperationWithdraw),\n        },\n      ];\n    case \"Noop\":\n      return [\n        \"Initial_operation\",\n        {\n          hash: hash,\n          nonce: Nonce.toDTO(nonce),\n          level: Level.toDTO(level),\n          operation: noopToDTO(content as OperationNoop),\n        },\n      ];\n  }\n};\n\nexport default {\n  createTransaction,\n  createVmOperation,\n  createWithdraw,\n  createNoop,\n  toDTO,\n};\n","export type TicketID = {\n  ticketer: string;\n  data: string;\n};\n\nconst createTicketID = (ticketer: string, data: string): TicketID => {\n  return {\n    ticketer,\n    data,\n  };\n};\n\nexport default {\n  createTicketID,\n};\n","// Please, tell me there is a better JSON library that this one\n\nexport type JSONType =\n  | string\n  | number\n  | boolean\n  | { [x: string]: JSONType }\n  | Array<JSONType>\n  | null;\n\nexport default class JSONValue {\n  private _json: JSONType = null;\n\n  static of(json: JSONType): JSONValue {\n    const value = new JSONValue();\n    value._json = json;\n    return value;\n  }\n\n  null(): JSONValue {\n    return JSONValue.of(null);\n  }\n\n  at(field: string): JSONValue {\n    if (this._json === null) return this.null();\n    if (typeof this._json !== \"object\") return this.null();\n    if (Array.isArray(this._json)) return this.null();\n    if (!(field in this._json)) return this.null();\n    const value = this._json[field];\n    return JSONValue.of(value);\n  }\n\n  as_string(): string | null {\n    if (this._json === null) return null;\n    if (typeof this._json !== \"string\") return null;\n    return this._json;\n  }\n\n  as_int(): number | null {\n    if (this._json === null) return null;\n    if (typeof this._json !== \"number\") return null;\n    return this._json;\n  }\n\n  as_array(): Array<JSONValue> | null {\n    if (this._json === null) return null;\n    if (!Array.isArray(this._json)) return null;\n    return this._json.map((json) => JSONValue.of(json));\n  }\n\n  as_string_array(): Array<string> | null {\n    if (this._json === null) return null;\n    if (!Array.isArray(this._json)) return null;\n    const array = this._json.flatMap((elt) => {\n      const element = JSONValue.of(elt).as_string();\n      if (element === null) return [];\n      return [element];\n    });\n    return array.length === this._json.length ? array : null; // If the size of doesn't match it means there wasn't only strings in the array\n  }\n\n  as_json(): JSONType {\n    return this._json;\n  }\n\n  as_bool(): boolean | null {\n    if (this._json === null) return null;\n    if (typeof this._json !== \"boolean\") return null;\n    return this._json;\n  }\n}\n","import Level, { Level as LevelType } from \"./level\";\nimport { Address } from \"./address\";\nimport { Key } from \"./key\";\nimport JSONValue from \"../utils/json\";\n\nexport type Block = {\n  key: Key;\n  signature: string;\n  block: {\n    author: Address;\n    level: LevelType;\n    previous: string;\n    payload: Array<string>; // TODO: should we parse the operation of a block ??\n    tezos_operations: Array<string>;\n  };\n};\n\nconst ofDTO = (dto: JSONValue): Block | null => {\n  const key_str = dto.at(\"key\").as_string();\n  const signature_str = dto.at(\"signature\").as_string();\n  const block = dto.at(\"block\");\n\n  const author_str = block.at(\"author\").as_string();\n  const level = Level.ofDTO(block.at(\"level\"));\n  const previous_str = block.at(\"previous\").as_string();\n  const payload_json = block.at(\"payload\").as_string_array();\n  const tezos_operations = block.at(\"tezos_operations\").as_string_array();\n\n  if (key_str === null) return null;\n  if (signature_str === null) return null;\n  if (author_str === null) return null;\n  if (level === null) return null;\n  if (previous_str === null) return null;\n  if (payload_json === null) return null;\n  if (tezos_operations === null) return null;\n\n  return {\n    key: key_str,\n    signature: signature_str,\n    block: {\n      author: author_str,\n      level,\n      previous: previous_str,\n      payload: payload_json,\n      tezos_operations,\n    },\n  };\n};\n\nexport default {\n  ofDTO,\n};\n","import { Address } from \"./address\";\nimport { fromB58Hash } from \"../utils/hash\";\nimport JSONValue from \"../utils/json\";\n// import { TicketID } from \"./ticket-id\" TBD\n\nexport type Proof = {\n  withdrawal_handles_hash: string; // FIXME? should we define a type for each hash\n  handle: {\n    id: number; // bleh\n    owner: Address;\n    ticket_id: {\n      ticketer: string;\n      data: string;\n    };\n    hash: string;\n    amount: string;\n  };\n  proof: string[];\n};\n\nconst ofDTO = (json: JSONValue): Proof | null => {\n  console.log(json.as_json());\n  const withdrawal_handles_hash = json\n    .at(\"withdrawal_handles_hash\")\n    .as_string();\n  const handle = json.at(\"handle\");\n  const proof = json.at(\"proof\").as_array();\n\n  if (proof === null) return null;\n  const proof2 = proof\n    .flatMap((x: JSONValue) => {\n      const y = x.as_array();\n      if (y === null) {\n        throw \"nope\";\n      }\n\n      return [y];\n    })\n    .flat();\n  console.log(proof2);\n  const proof3 = proof2.flatMap((x: JSONValue) => {\n    const y = x.as_string();\n\n    if (y === null) {\n      console.log(y);\n      throw \"Nope\";\n    }\n    return [fromB58Hash(y)];\n  });\n\n  const id = handle.at(\"id\").as_int();\n  const owner = handle.at(\"owner\").as_array();\n  const ticket_id = handle.at(\"ticket_id\").as_array();\n\n  if (ticket_id === null) return null;\n\n  const ticketer = ticket_id[1].at(\"ticketer\").as_string();\n  const data = ticket_id[1].at(\"data\").as_string();\n  const hash = handle.at(\"hash\").as_string();\n  const amount = handle.at(\"amount\").as_string();\n\n  if (withdrawal_handles_hash === null) return null;\n  console.log(\"a\");\n  if (proof === null) return null;\n  console.log(\"b\");\n  if (id === null) return null;\n  console.log(\"c\");\n  if (owner === null) return null;\n  console.log(\"d\");\n  if (ticketer === null) return null;\n  console.log(\"e\");\n  if (data === null) return null;\n  console.log(\"f\");\n  if (hash === null) return null;\n  console.log(\"g\");\n  if (amount === null) return null;\n  console.log(\"h\");\n\n  const address = owner[1].as_string();\n  if (address === null) return null;\n  console.log(\"i\");\n  return {\n    withdrawal_handles_hash: fromB58Hash(withdrawal_handles_hash),\n    handle: {\n      id,\n      owner: address,\n      ticket_id: {\n        ticketer,\n        data,\n      },\n      hash,\n      amount,\n    },\n    proof: proof3,\n  };\n};\n\nexport default {\n  ofDTO,\n};\n","// https://github.com/jfromaniello/url-join\n\n// MIT License\n\n// Copyright (c) 2015 José F. Romaniello\n\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in all\n// copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n// SOFTWARE.\n\nfunction normalize(strArray: string[]) {\n  const resultArray: string[] = [];\n  if (strArray.length === 0) {\n    return \"\";\n  }\n\n  if (typeof strArray[0] !== \"string\") {\n    throw new TypeError(\"Url must be a string. Received \" + strArray[0]);\n  }\n\n  // If the first part is a plain protocol, we combine it with the next part.\n  if (strArray[0].match(/^[^/:]+:\\/*$/) && strArray.length > 1) {\n    strArray[0] = strArray.shift() + strArray[0];\n  }\n\n  // There must be two or three slashes in the file protocol, two slashes in anything else.\n  if (strArray[0].match(/^file:\\/\\/\\//)) {\n    strArray[0] = strArray[0].replace(/^([^/:]+):\\/*/, \"$1:///\");\n  } else {\n    strArray[0] = strArray[0].replace(/^([^/:]+):\\/*/, \"$1://\");\n  }\n\n  for (let i = 0; i < strArray.length; i++) {\n    let component = strArray[i];\n\n    if (typeof component !== \"string\") {\n      throw new TypeError(\"Url must be a string. Received \" + component);\n    }\n\n    if (component === \"\") {\n      continue;\n    }\n\n    if (i > 0) {\n      // Removing the starting slashes for each component but the first.\n      component = component.replace(/^[/]+/, \"\");\n    }\n    if (i < strArray.length - 1) {\n      // Removing the ending slashes for each component but the last.\n      component = component.replace(/[/]+$/, \"\");\n    } else {\n      // For the last component we will combine multiple slashes to a single one.\n      component = component.replace(/[/]+$/, \"/\");\n    }\n\n    resultArray.push(component);\n  }\n\n  let str = resultArray.join(\"/\");\n  // Each input component is now separated by a single slash except the possible first plain protocol part.\n\n  // remove trailing slash before parameters or hash\n  str = str.replace(/\\/(\\?|&|#[^!])/g, \"$1\");\n\n  // replace ? in parameters with &\n  const parts = str.split(\"?\");\n  str = parts.shift() + (parts.length > 0 ? \"?\" : \"\") + parts.join(\"&\");\n\n  return str;\n}\n\nexport default function urlJoin(...args: string[]): string {\n  const parts = Array.from(Array.isArray(args[0]) ? args[0] : args);\n  return normalize(parts);\n}\n","import JSONValue, { JSONType } from \"../utils/json\";\nimport Level, { Level as LevelType } from \"../core/level\";\nimport Block, { Block as BlockType } from \"../core/block\";\nimport Proof, { Proof as ProofType } from \"../core/proof\";\nimport { TicketID } from \"../core/ticket-id\";\nimport urlJoin from \"../utils/urlJoin\";\n\nconst VERSION = \"/api/v1\";\n\ntype endpoint<T> = {\n  uri: string;\n  expectedStatus: number;\n  parse: (json: JSONValue) => T | null;\n};\n\n/* FIXME: reintroduce discovery when the API supports it */\nexport type endpoints = {\n  GET_CHAIN_INFO: endpoint<{\n    consensus: string;\n    isSync: boolean;\n  }>;\n  GET_CURRENT_LEVEL: endpoint<LevelType>;\n  GET_BLOCK_BY_LEVEL: (level: LevelType) => endpoint<BlockType>;\n  GET_BLOCK_BY_HASH: (hash: string) => endpoint<BlockType>;\n  GET_GENESIS: endpoint<BlockType>;\n  GET_CURRENT_BLOCK: endpoint<BlockType>;\n  GET_BALANCE: (address: string, ticket_id: TicketID) => endpoint<number>;\n  GET_PROOF: (operation_hash: string) => endpoint<ProofType>;\n  OPERATIONS: endpoint<string>;\n  GET_VM_STATE: endpoint<JSONType>;\n  ENCODE_OPERATION: endpoint<Buffer>;\n};\n\nexport const makeEndpoints = (root: string): endpoints => ({\n  GET_CHAIN_INFO: {\n    uri: urlJoin(root, `${VERSION}/chain/info`),\n    expectedStatus: 200,\n    parse: (json: JSONValue) => {\n      const consensus = json.at(\"consensus\").as_string();\n      if (consensus === null) return null;\n      // const discovery = json.at(\"discovery\").as_string();\n      // if (discovery === null) return null;\n      const isSync = json.at(\"is_sync\").as_bool();\n      if (isSync === null) return null;\n\n      return { consensus, isSync };\n    },\n  },\n  GET_CURRENT_LEVEL: {\n    uri: urlJoin(root, `${VERSION}/chain/level`),\n    expectedStatus: 200,\n    parse: (json: JSONValue) => {\n      const level_json = json.at(\"level\");\n      return Level.ofDTO(level_json);\n    },\n  },\n  GET_BLOCK_BY_LEVEL: (level: LevelType) => ({\n    uri: urlJoin(root, `${VERSION}/chain/blocks/${Level.toDTO(level)}`),\n    expectedStatus: 200,\n    parse: Block.ofDTO,\n  }),\n  GET_BLOCK_BY_HASH: (blockHash: string) => ({\n    uri: urlJoin(root, `${VERSION}/chain/blocks/${blockHash}`),\n    expectedStatus: 200,\n    parse: Block.ofDTO,\n  }),\n  GET_GENESIS: {\n    uri: urlJoin(root, `${VERSION}/chain/blocks/genesis`),\n    expectedStatus: 200,\n    parse: Block.ofDTO,\n  },\n  GET_CURRENT_BLOCK: {\n    uri: urlJoin(root, `${VERSION}/chain/blocks/genesis`),\n    expectedStatus: 200,\n    parse: Block.ofDTO,\n  },\n  GET_BALANCE: (address: string, ticket_id: TicketID) => ({\n    uri: urlJoin(\n      root,\n      `${VERSION}/balance/${address}/${ticket_id.ticketer}/${ticket_id.data}`\n    ),\n    expectedStatus: 200,\n    parse: (json: JSONValue) => {\n      return json.at(\"balance\").as_int();\n    },\n  }),\n  GET_PROOF: (operation_hash: string) => ({\n    uri: urlJoin(root, `${VERSION}/proof/${operation_hash}`),\n    expectedStatus: 200,\n    parse: Proof.ofDTO,\n  }),\n  OPERATIONS: {\n    uri: urlJoin(root, `${VERSION}/operations`),\n    expectedStatus: 200,\n    parse: (json: JSONValue) => {\n      const hash = json.at(\"hash\").as_string();\n      return hash;\n    },\n  },\n  GET_VM_STATE: {\n    uri: urlJoin(root, `${VERSION}/state/unix`),\n    expectedStatus: 200,\n    parse: (json: JSONValue) => {\n      const state = json.as_json();\n      return state;\n    },\n  },\n  ENCODE_OPERATION: {\n    uri: urlJoin(root, `${VERSION}/helpers/encode-operation`),\n    expectedStatus: 200,\n    parse: (json: JSONValue) => {\n      const bytes = json.at(\"bytes\").as_string();\n      if (bytes === null) return null;\n      return Buffer.from(bytes, \"hex\");\n    },\n  },\n});\n\nconst parse = async <T>(\n  endpoint: endpoint<T>,\n  status: number,\n  json: JSONType\n): Promise<T> => {\n  if (status !== endpoint.expectedStatus) {\n    return Promise.reject(json);\n  }\n\n  const jsonValue = JSONValue.of(json);\n  const parsedResponse = endpoint.parse(jsonValue);\n  if (parsedResponse === null) {\n    return Promise.reject({ type: \"ERROR\", msg: \"please contact the team\" });\n  }\n  return parsedResponse;\n};\n\nexport const get = async <T>(endpoint: endpoint<T>): Promise<T> => {\n  const uri = endpoint.uri;\n  const response = await fetch(uri);\n\n  const status = response.status;\n  const json: JSONType = await response.json();\n  return parse(endpoint, status, json);\n};\n\nexport const post = async <T>(\n  endpoint: endpoint<T>,\n  content: unknown\n): Promise<T> => {\n  const uri = endpoint.uri;\n  const body = JSON.stringify(content);\n  const response = await fetch(uri, { method: \"POST\", body });\n  const status = response.status;\n  const json: JSONType = await response.json();\n  return parse(endpoint, status, json);\n};\n","import { Key } from \"../core/key\";\nimport { KeyHash } from \"../core/key-hash\";\nimport Operation, { Operation as OperationType } from \"../core/operation\";\nimport { JSONType } from \"../utils/json\";\n\ninterface MemorySigner {\n  sign: (payload: string) => Promise<{ prefixSig: string }>;\n  publicKey: () => Promise<Key>;\n  publicKeyHash: () => Promise<KeyHash>;\n}\n\ninterface BeaconSigner {\n  getActiveAccount: () => Promise<\n    { address: KeyHash; publicKey: Key } | undefined\n  >;\n  requestSignPayload: ({\n    payload,\n  }: {\n    payload: string;\n  }) => Promise<{ signature: string } | undefined | null>;\n}\n\ninterface CustomSigner {\n  sign: (payload: string) => Promise<string>;\n  publicKey: () => Promise<Key>;\n  publicKeyHash: () => Promise<KeyHash>;\n}\n\nexport abstract class DekuSigner {\n  abstract sign(payload: string): Promise<string>;\n  abstract publicKey: () => Promise<Key>;\n  abstract publicKeyHash: () => Promise<KeyHash>;\n\n  async signOperation(operation: OperationType): Promise<JSONType> {\n    const bytes = operation.bytes;\n    const signature = await this.sign(bytes.toString(\"hex\"));\n\n    const key = await this.publicKey();\n    const dto = Operation.toDTO(operation);\n    return {\n      key,\n      signature,\n      initial: dto,\n    };\n  }\n}\n\n/**\n * Converts a memory signer to a deku signer\n * @param signer a memory signer instanciante by \"InMemorySigner\"\n * @returns a deku signer\n */\nexport const fromMemorySigner = (signer: MemorySigner): DekuSigner => {\n  class MemorySigner extends DekuSigner {\n    sign = async (payload: string) => {\n      console.log(\"fromMemorySigner\", payload);\n      const signature = await signer.sign(payload);\n      return signature.prefixSig;\n    };\n    publicKey = () => signer.publicKey();\n    publicKeyHash = () => signer.publicKeyHash();\n  }\n  return new MemorySigner();\n};\n\n/**\n * Converts a beacon signer to a deku signer\n * @param signer a beacon signer instanciante by \"DAppClient\"\n * @returns a deku signer\n */\nexport const fromBeaconSigner = (signer: BeaconSigner): DekuSigner => {\n  class BeaconSigner extends DekuSigner {\n    sign = async (payload: string) => {\n      console.log(\"fromBeaconSigner\", payload);\n      const sig = await signer.requestSignPayload({ payload });\n      if (!sig) {\n        return Promise.reject({\n          type: \"SIGNER_ERROR\",\n          msg: \"cannot sign payload\",\n        });\n      }\n      return sig.signature;\n    };\n    publicKey = async () => {\n      const account = await signer.getActiveAccount();\n      if (!account) {\n        return Promise.reject({\n          type: \"SIGNER_ERROR\",\n          msg: \"Your account is not active\",\n        });\n      }\n      return account.publicKey;\n    };\n    publicKeyHash = async () => {\n      const account = await signer.getActiveAccount();\n      if (!account) {\n        return Promise.reject({\n          type: \"SIGNER_ERROR\",\n          msg: \"Your account is not active\",\n        });\n      }\n      return account.address;\n    };\n  }\n  return new BeaconSigner();\n};\n\nexport const fromCustomSigner = (signer: CustomSigner): DekuSigner => {\n  class CustomSigner extends DekuSigner {\n    sign = async (payload: string) => signer.sign(payload);\n    publicKey = async () => signer.publicKey();\n    publicKeyHash = async () => signer.publicKeyHash();\n  }\n  return new CustomSigner();\n};\n","import { TezosToolkit } from \"@taquito/taquito\";\nimport Consensus from \"./contracts/consensus\";\nimport Discovery from \"./contracts/discovery\";\nimport { Address as AddressType } from \"./core/address\";\nimport { Amount as AmountType } from \"./core/amount\";\nimport { Block as BlockType } from \"./core/block\";\nimport { KeyHash as KeyHashType } from \"./core/key-hash\";\nimport Level, { Level as LevelType } from \"./core/level\";\nimport Nonce, { Nonce as NonceType } from \"./core/nonce\";\nimport { Operation as OperationType } from \"./core/operation\";\nimport Operation from \"./core/operation\";\nimport { OperationHash as OperationHashType } from \"./core/operation-hash\";\nimport TicketID from \"./core/ticket-id\";\nimport { endpoints, get, makeEndpoints, post } from \"./network\";\nimport { JSONType } from \"./utils/json\";\nimport { DekuSigner } from \"./utils/signers\";\nexport type Proof = import(\"./core/proof\").Proof;\n\n/* FIXME: reintroduce discovery when the API supports it */\n\nexport type Setting = {\n  dekuRpc: string;\n  dekuSigner?: DekuSigner;\n};\n\nexport type OptOptions = {\n  nonce?: NonceType;\n  level?: LevelType;\n};\n\ntype OperationInfo = {\n  source: KeyHashType;\n  nonce: NonceType;\n  level: LevelType;\n};\n\nexport class DekuToolkit {\n  private endpoints: endpoints;\n  private _dekuSigner: DekuSigner | undefined;\n\n  private _consensus: Consensus | undefined;\n  private _discovery: Discovery | undefined;\n\n  private _dekuRpc: string;\n\n  constructor(setting: Setting) {\n    this._dekuRpc = setting.dekuRpc;\n    this.endpoints = makeEndpoints(setting.dekuRpc);\n    this._dekuSigner = setting.dekuSigner;\n  }\n\n  /**\n   * Sets the deku signer\n   * @param wallet the wallet you want to use\n   * @returns deku toolkit\n   */\n  setDekuSigner(signer: DekuSigner): DekuToolkit {\n    this._dekuSigner = signer;\n    return this;\n  }\n\n  /**\n   * Utils function that check if the deku signer is setup\n   * @returns void if the signer is set, otherwise the promise is rejected\n   */\n  private assertTzWallet(): DekuSigner {\n    if (!this._dekuSigner) {\n      throw new Error(\"Tezos wallet required, see setTzWallet\");\n    }\n    return this._dekuSigner;\n  }\n\n  /**\n   * Sets ther tezos rpc node\n   * @param rpc the url of the tezos rpc,\n   * @returns\n   */\n  setTezosRpc(rpc: string): DekuToolkit {\n    const tezos = new TezosToolkit(rpc);\n    // get the consensus and discovery address\n    const uri = this.endpoints[\"GET_CHAIN_INFO\"];\n    const consensusContract = () =>\n      get(uri).then(({ consensus }) => tezos.contract.at(consensus));\n    // const discoveryContract = () => get(uri).then(({ discovery }) => tezos.contract.at(discovery));\n    this._consensus = new Consensus(consensusContract);\n    // this._discovery = new Discovery(discoveryContract);\n    return this;\n  }\n\n  get dekuRpc(): string {\n    return this._dekuRpc;\n  }\n\n  /**\n   * Access the consensus contract to interact with it\n   * @return the consensus contract\n   */\n  get consensus(): Consensus | undefined {\n    return this._consensus;\n  }\n\n  /**\n   * Access the discovery contract to interact with it\n   * @return the consensus contract\n   */\n  get discovery(): Discovery | undefined {\n    throw \"Not implemented\";\n    // return this._discovery;\n  }\n\n  /**\n   * Returns the address of the consensus and discovery used by the deku chain\n   * @returns the consensus and discovery addresses\n   */\n  async info(): Promise<{ consensus: string }> {\n    const info = await get(this.endpoints[\"GET_CHAIN_INFO\"]);\n    return info;\n  }\n\n  /**\n   * Returns the current level of the chain\n   * @returns the level of the chain as a promise\n   */\n  async level(): Promise<LevelType> {\n    const level = await get(this.endpoints[\"GET_CURRENT_LEVEL\"]);\n    return level;\n  }\n\n  /**\n   * Returns the block at the given level\n   * @param level the level of the block to return\n   * @returns the block at the given level\n   */\n  async getBlockByLevel(level: LevelType): Promise<BlockType> {\n    const block = await get(this.endpoints[\"GET_BLOCK_BY_LEVEL\"](level));\n    return block;\n  }\n\n  /**\n   * Returns the block at the given hash\n   * @param hash the hash of the block to return\n   * @returns the block from the given hash\n   */\n  async getBlockByHash(hash: string): Promise<BlockType> {\n    const block = await get(this.endpoints[\"GET_BLOCK_BY_HASH\"](hash));\n    return block;\n  }\n\n  /**\n   * Returns the genesis block\n   * @returns the genesis block\n   */\n  async getGenesis(): Promise<BlockType> {\n    const block = await get(this.endpoints[\"GET_GENESIS\"]);\n    return block;\n  }\n\n  /**\n   * Returns the current block of deku\n   * @returns the current block\n   */\n  async getCurrentBlock(): Promise<BlockType> {\n    const block = await get(this.endpoints[\"GET_CURRENT_BLOCK\"]);\n    return block;\n  }\n\n  async getBalance(\n    address: string,\n    { ticketer, data }: { ticketer: string; data: string }\n  ): Promise<number> {\n    const ticket_id = TicketID.createTicketID(\n      ticketer,\n      data.startsWith(\"0x\") ? data : \"0x\" + data\n    );\n    const balance = await get(\n      this.endpoints[\"GET_BALANCE\"](address, ticket_id)\n    );\n    return balance;\n  }\n\n  async getProof(operation_hash: string): Promise<Proof> {\n    const proof = await get(this.endpoints[\"GET_PROOF\"](operation_hash));\n    return proof;\n  }\n\n  /**\n   * Convert an optional operation options to operation info: source, level, nonce\n   * If the level is not provided, the returned level is the current level of the chain\n   * If the nonce is not provided, the returned nonce is a random one\n   * The source is always the source of the signer\n   * @param options\n   * @returns the source, a level and a nonce\n   */\n  private async submitOperation(\n    operation: OperationType\n  ): Promise<OperationHashType> {\n    // Retrieve the deku signer\n    const dekuSigner = this.assertTzWallet();\n\n    // Sign the transaction\n    const signedOperation = await dekuSigner.signOperation(operation);\n\n    // Send the operation\n    const hash = await post(this.endpoints[\"OPERATIONS\"], signedOperation);\n    return hash;\n  }\n\n  async getVmState(): Promise<JSONType> {\n    const state = await get(this.endpoints[\"GET_VM_STATE\"]);\n    return state;\n  }\n\n  /**\n   * Convert an optional operation options to operation info: source, level, nonce\n   * If the level is not provided, the returned level is the current level of the chain\n   * If the nonce is not provided, the returned nonce is a random one\n   * The source is always the source of the signer\n   * @param options\n   * @returns the source, a level and a nonce\n   */\n  private async parseOperationOptions(\n    options?: OptOptions\n  ): Promise<OperationInfo> {\n    const dekuSigner = this.assertTzWallet();\n    const source = await dekuSigner.publicKeyHash();\n    const level =\n      options === undefined || options.level === undefined\n        ? await this.level()\n        : options.level;\n    const nonce =\n      options === undefined || options.nonce === undefined\n        ? Nonce.rand()\n        : options.nonce;\n    return {\n      source,\n      level,\n      nonce,\n    };\n  }\n\n  /** Helper to encode operation to binary, so that core/operations stay pure\n   * TODO: find a way to not use the API\n   */\n  private async encodeOperation(\n    nonce: NonceType,\n    level: NonceType,\n    operation: unknown\n  ): Promise<Buffer> {\n    const body = {\n      nonce: Nonce.toDTO(nonce),\n      level: Level.toDTO(level),\n      operation,\n    };\n    return post(this.endpoints[\"ENCODE_OPERATION\"], body);\n  }\n\n  /**\n   * Transfer some ticket to someone\n   * @param receiver the address of the ticket receiver\n   * @param amount the amount of ticket you want to send\n   * @param options to define a custom level/nonce\n   * @param ticketer KT address, first half of the ticket id\n   * @param data other half of the ticket id\n   * @returns an operation hash of the transfer\n   */\n  async transferTo(\n    receiver: AddressType,\n    amount: AmountType,\n    ticketer: string,\n    data: string,\n    options?: OptOptions\n  ): Promise<OperationHashType> {\n    const { source, level, nonce } = await this.parseOperationOptions(options);\n    // Create the transaction\n    const transaction = await Operation.createTransaction(\n      this.encodeOperation.bind(this),\n      level,\n      nonce,\n      source,\n      receiver,\n      amount,\n      ticketer,\n      data\n    );\n    return this.submitOperation(transaction);\n  }\n\n  /**\n   * Withdraw\n   * @param owner the address of the ticket owner on Tezos (e.g. a KT1)\n   * @param amount the amount of ticket you want to withdraw\n   * @param options to define a custom level/nonce\n   * @param ticketer KT1 address, first half of the ticket id\n   * @param data other half of the ticket id\n   * @returns an operation hash of the withdraw\n   */\n  async withdrawTo(\n    owner: AddressType,\n    amount: AmountType,\n    ticketer: string,\n    data: string,\n    options?: OptOptions\n  ): Promise<OperationHashType> {\n    const { source, level, nonce } = await this.parseOperationOptions(options);\n    // Create the withdraw\n    const withdraw = await Operation.createWithdraw(\n      this.encodeOperation.bind(this),\n      level,\n      nonce,\n      source,\n      owner,\n      amount,\n      ticketer,\n      data\n    );\n    return this.submitOperation(withdraw);\n  }\n\n  /**\n   * Submits an operation to the vm\n   * @param payload the string (TODO: is it better to have a json instead of a string ?)\n   * @param options {level, nonce} optional options\n   * @returns the hash the submitted operation\n   */\n  async submitVmOperation(\n    payload: unknown,\n    options?: OptOptions\n  ): Promise<OperationHashType> {\n    const { source, level, nonce } = await this.parseOperationOptions(options);\n    // Create the vm transaction\n    const vmOperation = await Operation.createVmOperation(\n      this.encodeOperation.bind(this),\n      level,\n      nonce,\n      source,\n      payload\n    );\n    return this.submitOperation(vmOperation);\n  }\n\n  /**\n   * Submits a noop operation to the vm\n   * @param options {level, nonce} optional options\n   * @returns the hash of the submitted operation\n   */\n  async submitNoopOperation(options?: OptOptions): Promise<OperationHashType> {\n    const { source, level, nonce } = await this.parseOperationOptions(options);\n    // Create the noop operation\n    const noopOperation = await Operation.createNoop(\n      this.encodeOperation.bind(this),\n      level,\n      nonce,\n      source\n    );\n    return this.submitOperation(noopOperation);\n  }\n\n  async wait(operationHash: OperationHashType): Promise<LevelType> {\n    console.log(operationHash);\n    throw \"Feature not yet implemented\"; // TODO: implement this feature\n  }\n}\n\nexport {\n  fromBeaconSigner,\n  fromCustomSigner,\n  fromMemorySigner,\n} from \"./utils/signers\";\n"],"names":["toDTO","ofDTO","blake","bs58check","Base58","TezosToolkit"],"mappings":"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"}